#!/usr/bin/expect -f

set timeout 60
spawn ssh -p 65002 -o StrictHostKeyChecking=no u570718221@82.25.125.174

expect {
    "password:" {
        send "Ananyar@1\r"
        exp_continue
    }
    "$ " {
        send "cd /home/u570718221/domains/api.bytevantage.in/public_html/api\r"
        expect "$ "
        
        # Create comprehensive endpoint testing script
        send "cat > endpoint_test.sh << 'EOF'\r"
        expect "> "
        send "#!/bin/bash\r"
        expect "> "
        send "echo '=== COMPREHENSIVE ENDPOINT TESTING ==='\r"
        expect "> "
        send "BASE_URL=\"http://localhost:3001\"\r"
        expect "> "
        send "\r"
        expect "> "
        send "# Test basic endpoints\r"
        expect "> "
        send "echo 'Testing /health endpoint...'\r"
        expect "> "
        send "curl -s $BASE_URL/health | head -c 100\r"
        expect "> "
        send "echo ''\r"
        expect "> "
        send "\r"
        expect "> "
        send "echo 'Testing /dashboard endpoint...'\r"
        expect "> "
        send "curl -s $BASE_URL/dashboard | grep -o 'ByteVantage\\|Enterprise\\|Dashboard' | head -3\r"
        expect "> "
        send "echo ''\r"
        expect "> "
        send "\r"
        expect "> "
        send "echo 'Testing /admin/licenses endpoint...'\r"
        expect "> "
        send "curl -s $BASE_URL/admin/licenses | grep -o 'License\\|Management' | head -3\r"
        expect "> "
        send "echo ''\r"
        expect "> "
        send "\r"
        expect "> "
        send "echo 'Testing /admin/licenses-enhanced endpoint...'\r"
        expect "> "
        send "curl -s $BASE_URL/admin/licenses-enhanced | grep -o 'Edit Payment\\|Enhanced\\|License' | head -3\r"
        expect "> "
        send "echo ''\r"
        expect "> "
        send "\r"
        expect "> "
        send "echo 'Testing /admin/payments endpoint...'\r"
        expect "> "
        send "curl -s $BASE_URL/admin/payments | grep -o 'Payment\\|Management' | head -3\r"
        expect "> "
        send "echo ''\r"
        expect "> "
        send "\r"
        expect "> "
        send "echo 'Testing API endpoints...'\r"
        expect "> "
        send "curl -s -H 'Authorization: Bearer test' $BASE_URL/api/admin/payments | head -c 100\r"
        expect "> "
        send "echo ''\r"
        expect "> "
        send "\r"
        expect "> "
        send "echo 'All endpoint tests completed.'\r"
        expect "> "
        send "EOF\r"
        expect "$ "
        
        # Make script executable and run it
        send "chmod +x endpoint_test.sh\r"
        expect "$ "
        send "./endpoint_test.sh\r"
        expect "$ "
        
        send "exit\r"
    }
    timeout {
        puts "Connection timed out"
        exit 1
    }
    eof
}