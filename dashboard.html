<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ByteVantage Enterprise Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --dark-bg: #1a1a1a;
            --card-bg: #ffffff;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .hero-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, #f8f9fa 100%);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .chart-container {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 1.5rem;
        }
        
        .quick-action-btn {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            border: none;
            border-radius: 10px;
            color: white;
            padding: 15px 25px;
            margin: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .activity-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid var(--secondary-color);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online { background: var(--success-color); }
        .status-warning { background: var(--warning-color); }
        .status-offline { background: var(--danger-color); }
        
        @media (max-width: 768px) {
            .stats-card {
                margin-bottom: 1rem;
            }
            
            .quick-action-btn {
                display: block;
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-alt"></i> ByteVantage Enterprise
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/licenses-enhanced"><i class="fas fa-key"></i> License Management</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/customers"><i class="fas fa-users"></i> Customer Management</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/analytics"><i class="fas fa-chart-bar"></i> Analytics</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/settings"><i class="fas fa-cog"></i> Settings</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item position-relative">
                        <a class="nav-link" href="#" onclick="showNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationCount">3</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/login"><i class="fas fa-user"></i> Admin</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <!-- Hero Section -->
        <div class="hero-section p-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-4 fw-bold text-primary mb-3">
                        <i class="fas fa-chart-line"></i> Enterprise Dashboard
                    </h1>
                    <p class="lead text-muted">
                        Complete license management and business intelligence platform for enterprise software distribution.
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex flex-column align-items-end">
                        <div class="mb-2">
                            <span class="status-indicator status-online"></span>
                            <strong>System Status: </strong><span class="text-success">Online</span>
                        </div>
                        <div class="mb-2">
                            <strong>Server Time: </strong><span id="serverTime"></span>
                        </div>
                        <div>
                            <strong>Version: </strong><span class="badge bg-primary">v1.0.0-enterprise</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stats-icon me-3" style="background: linear-gradient(135deg, var(--success-color), #2ecc71);">
                            <i class="fas fa-key"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Active Licenses</h5>
                            <h3 class="mb-0 text-success" id="activeLicenses">Loading...</h3>
                            <small class="text-muted">+12% this month</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stats-icon me-3" style="background: linear-gradient(135deg, var(--secondary-color), #5dade2);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Total Customers</h5>
                            <h3 class="mb-0 text-primary" id="totalCustomers">Loading...</h3>
                            <small class="text-muted">+8% this month</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stats-icon me-3" style="background: linear-gradient(135deg, var(--warning-color), #f7dc6f);">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Revenue (₹)</h5>
                            <h3 class="mb-0 text-warning" id="totalRevenue">Loading...</h3>
                            <small class="text-muted">+25% this month</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stats-icon me-3" style="background: linear-gradient(135deg, var(--danger-color), #ec7063);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Expiring Soon</h5>
                            <h3 class="mb-0 text-danger" id="expiringSoon">Loading...</h3>
                            <small class="text-muted">Next 30 days</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-lightning-bolt"></i> Quick Actions</h5>
                    </div>
                    <div class="card-body text-center">
                        <a href="/admin/licenses-enhanced?action=create" class="quick-action-btn">
                            <i class="fas fa-plus-circle"></i> Create New License
                        </a>
                        <a href="/admin/customers?action=add" class="quick-action-btn">
                            <i class="fas fa-user-plus"></i> Add Customer
                        </a>
                        <a href="/admin/products" class="quick-action-btn">
                            <i class="fas fa-box"></i> Manage Products
                        </a>
                        <a href="/admin/analytics" class="quick-action-btn">
                            <i class="fas fa-chart-pie"></i> View Reports
                        </a>
                        <a href="/admin/payments" class="quick-action-btn">
                            <i class="fas fa-credit-card"></i> Payment History
                        </a>
                        <a href="/admin/backups" class="quick-action-btn">
                            <i class="fas fa-download"></i> System Backup
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts and Analytics -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="chart-container">
                    <h5 class="mb-3"><i class="fas fa-chart-line"></i> Revenue Trends</h5>
                    <canvas id="revenueChart" height="100"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <div class="chart-container">
                    <h5 class="mb-3"><i class="fas fa-chart-pie"></i> License Distribution</h5>
                    <canvas id="licenseChart" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Activity and System Info -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-history"></i> Recent Activity</h5>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="recentActivity">
                            <!-- Activity items will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-server"></i> System Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center p-3">
                                    <div class="h4 mb-0" id="systemUptime">Loading...</div>
                                    <small class="text-muted">System Uptime</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center p-3">
                                    <div class="h4 mb-0" id="databaseStatus">
                                        <span class="status-indicator status-online"></span>Connected
                                    </div>
                                    <small class="text-muted">Database Status</small>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-12">
                                <h6>API Endpoints Status:</h6>
                                <div class="mt-2">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>/health</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>/api/admin/dashboard</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>/api/licenses/*</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="modal fade" id="notificationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-bell"></i> Notifications</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>License Expiring:</strong> DEMO-FINAL-1757364048173 expires in 5 days
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-user-plus"></i>
                        <strong>New Customer:</strong> Test Company Ltd registered
                    </div>
                    <div class="alert alert-success">
                        <i class="fas fa-money-bill"></i>
                        <strong>Payment Received:</strong> ₹35,000 from Test Company Ltd
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let dashboardData = {};
        let revenueChart = null;
        let licenseChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            initializeCharts();
            updateServerTime();
            setInterval(updateServerTime, 1000);
            setInterval(loadDashboardData, 30000); // Refresh every 30 seconds
        });

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/admin/dashboard');
                if (response.ok) {
                    dashboardData = await response.json();
                    updateDashboardUI();
                } else {
                    // Fallback data if API is not accessible
                    dashboardData = {
                        stats: {
                            activeLicenses: 156,
                            totalCustomers: 89,
                            totalRevenue: 2847500,
                            expiringSoon: 7
                        },
                        uptime: '2d 14h 23m',
                        recentActivity: [
                            { type: 'license_created', description: 'New license created for ABC Corp', time: '2 minutes ago' },
                            { type: 'payment_received', description: 'Payment of ₹35,000 received', time: '15 minutes ago' },
                            { type: 'customer_registered', description: 'New customer XYZ Ltd registered', time: '1 hour ago' }
                        ]
                    };
                    updateDashboardUI();
                }
            } catch (error) {
                console.log('Using offline demo data');
                // Use demo data
                dashboardData = {
                    stats: {
                        activeLicenses: 156,
                        totalCustomers: 89,
                        totalRevenue: 2847500,
                        expiringSoon: 7
                    },
                    uptime: '2d 14h 23m',
                    recentActivity: [
                        { type: 'license_created', description: 'New license created for ABC Corp', time: '2 minutes ago' },
                        { type: 'payment_received', description: 'Payment of ₹35,000 received', time: '15 minutes ago' },
                        { type: 'customer_registered', description: 'New customer XYZ Ltd registered', time: '1 hour ago' }
                    ]
                };
                updateDashboardUI();
            }
        }

        // Update dashboard UI
        function updateDashboardUI() {
            if (dashboardData.stats) {
                document.getElementById('activeLicenses').textContent = dashboardData.stats.activeLicenses || 0;
                document.getElementById('totalCustomers').textContent = dashboardData.stats.totalCustomers || 0;
                document.getElementById('totalRevenue').textContent = formatCurrency(dashboardData.stats.totalRevenue || 0);
                document.getElementById('expiringSoon').textContent = dashboardData.stats.expiringSoon || 0;
            }

            if (dashboardData.uptime) {
                document.getElementById('systemUptime').textContent = dashboardData.uptime;
            }

            updateRecentActivity();
        }

        // Update recent activity
        function updateRecentActivity() {
            const activityContainer = document.getElementById('recentActivity');
            const activities = dashboardData.recentActivity || [];
            
            activityContainer.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="fw-semibold">${getActivityIcon(activity.type)} ${activity.description}</div>
                            <small class="text-muted">${activity.time}</small>
                        </div>
                    </div>
                </div>
            `).join('') || '<p class="text-center text-muted">No recent activity</p>';
        }

        // Get activity icon
        function getActivityIcon(type) {
            const icons = {
                license_created: '<i class="fas fa-key text-success"></i>',
                payment_received: '<i class="fas fa-rupee-sign text-warning"></i>',
                customer_registered: '<i class="fas fa-user-plus text-primary"></i>',
                license_expired: '<i class="fas fa-exclamation-triangle text-danger"></i>'
            };
            return icons[type] || '<i class="fas fa-info-circle"></i>';
        }

        // Initialize charts
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                    datasets: [{
                        label: 'Revenue (₹)',
                        data: [125000, 189000, 96000, 234000, 167000, 289000, 345000, 298000, 412000],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₹' + (value / 1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });

            // License Distribution Chart
            const licenseCtx = document.getElementById('licenseChart').getContext('2d');
            licenseChart = new Chart(licenseCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Basic', 'Professional', 'Enterprise', 'Demo'],
                    datasets: [{
                        data: [45, 67, 23, 21],
                        backgroundColor: [
                            '#27ae60',
                            '#3498db',
                            '#9b59b6',
                            '#f39c12'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Update server time
        function updateServerTime() {
            const now = new Date();
            document.getElementById('serverTime').textContent = now.toLocaleString();
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Show notifications
        function showNotifications() {
            const modal = new bootstrap.Modal(document.getElementById('notificationModal'));
            modal.show();
        }

        // System health check
        async function performHealthCheck() {
            try {
                const response = await fetch('/health');
                if (response.ok) {
                    const health = await response.json();
                    updateSystemStatus(health);
                }
            } catch (error) {
                console.error('Health check failed:', error);
            }
        }

        // Update system status
        function updateSystemStatus(health) {
            if (health.database && health.database.connected) {
                document.getElementById('databaseStatus').innerHTML = 
                    '<span class="status-indicator status-online"></span>Connected';
            } else {
                document.getElementById('databaseStatus').innerHTML = 
                    '<span class="status-indicator status-offline"></span>Disconnected';
            }
        }

        // Perform health check on load
        performHealthCheck();
        setInterval(performHealthCheck, 60000); // Every minute
    </script>
</body>
</html>